<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>í¬ë¦¬ì—ì´í„° ê³µì‹ ë‹µë³€ ë“±ë¡ | ì´ ê°•ì˜ ì–´ë•Œ?</title>
  <style>
    * { box-sizing: border-box; }
    body { font-family: -apple-system, sans-serif; background: #f8f9fa; margin: 0; display: flex; justify-content: center; padding: 40px 20px; min-height: 100vh; }
    .card { background: white; border-radius: 24px; padding: 30px; max-width: 440px; width: 100%; box-shadow: 0 10px 30px rgba(0,0,0,0.08); height: fit-content; }
    .logo { font-size: 14px; color: #aaa; margin-bottom: 24px; }
    h2 { font-size: 20px; margin: 0 0 6px; color: #1a1a1a; }
    .sub { font-size: 13px; color: #888; margin-bottom: 24px; line-height: 1.6; }
    .course-box { background: #f0f4ff; border-radius: 12px; padding: 14px 16px; font-size: 14px; font-weight: bold; color: #333; margin-bottom: 20px; }
    .course-label { font-size: 11px; color: #888; font-weight: normal; margin-bottom: 4px; }
    .guide { border: 1px solid #e8e8e8; border-radius: 12px; padding: 14px 16px; font-size: 13px; color: #555; margin-bottom: 20px; line-height: 1.8; }
    .guide-title { font-weight: bold; color: #333; margin-bottom: 8px; font-size: 13px; }
    textarea { width: 100%; height: 180px; border: 2px solid #e0e0e0; border-radius: 14px; padding: 14px; font-size: 14px; line-height: 1.7; resize: none; outline: none; transition: border-color 0.2s; font-family: -apple-system, sans-serif; }
    textarea:focus { border-color: #007bff; }
    .char-count { text-align: right; font-size: 12px; color: #bbb; margin: 6px 0 20px; }
    .legal-box { background: #fafafa; border: 1px solid #e8e8e8; border-radius: 10px; padding: 12px 14px; font-size: 11px; color: #999; line-height: 1.7; margin-bottom: 20px; }
    .submit-btn { width: 100%; background: #007bff; color: white; border: none; padding: 16px; border-radius: 14px; font-size: 15px; font-weight: bold; cursor: pointer; transition: background 0.2s; }
    .submit-btn:hover { background: #0069d9; }
    .submit-btn:disabled { background: #ccc; cursor: not-allowed; }
    .error-msg { color: #ff4d4f; font-size: 13px; text-align: center; margin-top: 12px; min-height: 20px; }
    .result { display: none; text-align: center; padding: 20px 0; line-height: 1.8; }
    .result-icon { font-size: 52px; margin-bottom: 16px; }
    .result-title { font-size: 18px; font-weight: bold; color: #1a1a1a; margin-bottom: 8px; }
    .result-sub { font-size: 14px; color: #888; }
  </style>
</head>
<body>
<div class="card">
  <div id="loading" style="text-align:center; padding:60px 0; color:#aaa; font-size:14px;">ì¸ì¦ í™•ì¸ ì¤‘...</div>

  <div id="form-area" style="display:none;">
    <div class="logo">ğŸ¤” ì´ ê°•ì˜ ì–´ë•Œ?</div>
    <h2>ğŸ™ í¬ë¦¬ì—ì´í„° ê³µì‹ ë‹µë³€ ë“±ë¡</h2>
    <p class="sub">ë³¸ì¸ ì¸ì¦ì´ ì™„ë£Œëœ í¬ë¦¬ì—ì´í„°ë§Œ ì´ í˜ì´ì§€ì— ì ‘ê·¼í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.<br>ì‘ì„±í•˜ì‹  ë‚´ìš©ì€ í•´ë‹¹ ê°•ì˜ í˜ì´ì§€ì— ê³µì‹ ë‹µë³€ìœ¼ë¡œ í‘œì‹œë©ë‹ˆë‹¤.</p>
    <div class="course-box">
      <div class="course-label">ë‹µë³€ ëŒ€ìƒ ê°•ì˜</div>
      <div id="course-title-box">ê°•ì˜ëª… ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</div>
    </div>
    <div class="guide">
      <div class="guide-title">ì‘ì„± ê°€ì´ë“œ</div>
      âœ… ìˆ˜ê°•ìƒì˜ ê²½í—˜ì„ ì¡´ì¤‘í•˜ëŠ” í†¤ìœ¼ë¡œ ì‘ì„±í•´ì£¼ì„¸ìš”<br>
      âœ… ê°œì„  ë‚´ìš©ì´ë‚˜ ì§€ì› ì‚¬í•­ì„ êµ¬ì²´ì ìœ¼ë¡œ ì•Œë ¤ì£¼ì‹œë©´ ì¢‹ìŠµë‹ˆë‹¤<br>
      âŒ ìˆ˜ê°•ìƒì„ íŠ¹ì •í•˜ê±°ë‚˜ ë¹„ë°©í•˜ëŠ” ë‚´ìš©ì€ ë¹„ê³µê°œ ì²˜ë¦¬ë©ë‹ˆë‹¤
    </div>
    <textarea id="reply-text" maxlength="1000" placeholder="ì˜ˆ) ìˆ˜ê°•í•´ì£¼ì‹  ë¶„ë“¤ê»˜ ë¨¼ì € ê°ì‚¬ë“œë¦½ë‹ˆë‹¤. ë§ì”€í•´ì£¼ì‹  ë¶€ë¶„ì— ëŒ€í•´ ì„¤ëª…ë“œë¦¬ê² ìŠµë‹ˆë‹¤..." oninput="updateCount()"></textarea>
    <div class="char-count"><span id="char-count">0</span> / 1000</div>
    <div class="legal-box">ë³¸ ë‹µë³€ì€ í¬ë¦¬ì—ì´í„°ê°€ ì§ì ‘ ë“±ë¡í•œ ê³µì‹ ì…ì¥ì…ë‹ˆë‹¤.<br>ìš´ì˜ìëŠ” ë‚´ìš©ì˜ ì‚¬ì‹¤ ì—¬ë¶€ë¥¼ ë³´ì¦í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.</div>
    <button class="submit-btn" id="submit-btn" onclick="submitReply()">ê³µì‹ ë‹µë³€ ë“±ë¡í•˜ê¸°</button>
    <p class="error-msg" id="error-msg"></p>
  </div>

  <div class="result" id="result-area">
    <div class="result-icon">âœ…</div>
    <div class="result-title">ê³µì‹ ë‹µë³€ì´ ë“±ë¡ë˜ì—ˆìŠµë‹ˆë‹¤</div>
    <div class="result-sub">ê°•ì˜ í˜ì´ì§€ì— í¬ë¦¬ì—ì´í„° ê³µì‹ ë‹µë³€ìœ¼ë¡œ í‘œì‹œë©ë‹ˆë‹¤.</div>
  </div>

  <div class="result" id="error-area">
    <div class="result-icon">âŒ</div>
    <div class="result-title" id="error-area-msg">ìœ íš¨í•˜ì§€ ì•Šì€ ë§í¬ì…ë‹ˆë‹¤</div>
    <div class="result-sub">ë§í¬ê°€ ë§Œë£Œë˜ì—ˆê±°ë‚˜ ì´ë¯¸ ì‚¬ìš©ëœ ë§í¬ì…ë‹ˆë‹¤.<br>ìš´ì˜íŒ€ìœ¼ë¡œ ë¬¸ì˜í•´ ì£¼ì„¸ìš”.</div>
  </div>
</div>

<script>
  const SUPABASE_URL = 'https://tctogguvgwvkxpymdsmn.supabase.co';
  const SUPABASE_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InRjdG9nZ3V2Z3d2a3hweW1kc21uIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjgwNzA0MzQsImV4cCI6MjA4MzY0NjQzNH0.sd54qY83b09GmsIKVWCB7IkjLrC1vePrhbhPHKnQazE';
  const headers = { 'apikey': SUPABASE_KEY, 'Authorization': 'Bearer ' + SUPABASE_KEY, 'Content-Type': 'application/json' };
  const token = new URLSearchParams(window.location.search).get('token');

  window.addEventListener('DOMContentLoaded', async () => {
    if (!token) return showError('í† í°ì´ ì—†ìŠµë‹ˆë‹¤.');
    const res = await fetch(`${SUPABASE_URL}/rest/v1/rpc/verify_creator_token`, { method: 'POST', headers, body: JSON.stringify({ input_token: token }) });
    const data = await res.json();
    if (!data || data.error || !data.course_id) return showError('ìœ íš¨í•˜ì§€ ì•Šì€ ë§í¬ì…ë‹ˆë‹¤.');
    const courseRes = await fetch(`${SUPABASE_URL}/rest/v1/courses?id=eq.${data.course_id}&select=title`, { headers });
    const courses = await courseRes.json();
    document.getElementById('course-title-box').textContent = courses[0]?.title || 'ê°•ì˜ëª…ì„ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.';
    document.getElementById('loading').style.display = 'none';
    document.getElementById('form-area').style.display = 'block';
  });

  function updateCount() {
    document.getElementById('char-count').textContent = document.getElementById('reply-text').value.length;
  }

  async function submitReply() {
    const content = document.getElementById('reply-text').value.trim();
    const errEl = document.getElementById('error-msg');
    if (content.length < 10) { errEl.textContent = 'ë‹µë³€ì€ 10ì ì´ìƒ ì…ë ¥í•´ì£¼ì„¸ìš”.'; return; }
    const btn = document.getElementById('submit-btn');
    btn.disabled = true;
    btn.textContent = 'ë“±ë¡ ì¤‘...';
    errEl.textContent = '';
    const res = await fetch(`${SUPABASE_URL}/rest/v1/rpc/submit_creator_response`, { method: 'POST', headers, body: JSON.stringify({ input_token: token, input_content: content }) });
    const result = await res.json();
    if (result?.success) {
      document.getElementById('form-area').style.display = 'none';
      document.getElementById('result-area').style.display = 'block';
    } else {
      errEl.textContent = result?.message || 'ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤. ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.';
      btn.disabled = false;
      btn.textContent = 'ê³µì‹ ë‹µë³€ ë“±ë¡í•˜ê¸°';
    }
  }

  function showError(msg) {
    document.getElementById('loading').style.display = 'none';
    document.getElementById('error-area-msg').textContent = msg;
    document.getElementById('error-area').style.display = 'block';
  }
</script>
</body>
</html>
